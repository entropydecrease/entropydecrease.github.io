{"version":3,"sources":["file:///Users/xiaojf/personal/OneDrive/private/blog/entropydecrease/themes/hugo-narrow/assets/js/dock.js"],"sourcesContent":["/**\n * 底部 Dock 控制脚本\n *\n * 功能：\n * - 支持三种显示模式：scroll（向上滚动显示）、always（始终显示）、float（悬浮显示）\n * - 基础的按钮点击事件处理\n */\n\n(function () {\n  \"use strict\";\n\n  let lastScrollTop = 0;\n  let isScrollingUp = false;\n  let scrollThreshold = 100; // 滚动阈值\n  let isDockVisible = false; // 悬浮模式的显示状态\n\n  const dock = document.getElementById(\"dock\");\n  const floatTrigger = document.getElementById(\"dock-float-trigger\");\n\n  if (!dock) return;\n\n  // 获取 dock 显示模式\n  const dockMode = dock.dataset.dockMode || \"scroll\";\n\n  // 滚动事件处理\n  function handleScroll() {\n    const currentScrollTop =\n      window.pageYOffset || document.documentElement.scrollTop;\n\n    // 判断滚动方向\n    if (currentScrollTop \u003c lastScrollTop) {\n      // 向上滚动\n      isScrollingUp = true;\n    } else {\n      // 向下滚动\n      isScrollingUp = false;\n    }\n\n    // 根据模式处理显示/隐藏 dock\n    switch (dockMode) {\n      case \"scroll\":\n        if (isScrollingUp \u0026\u0026 currentScrollTop \u003e scrollThreshold) {\n          showDock();\n        } else if (!isScrollingUp || currentScrollTop \u003c= scrollThreshold) {\n          hideDock();\n        }\n        break;\n      case \"always\":\n        showDock();\n        break;\n      case \"float\":\n        // 悬浮模式在滚动时自动隐藏 dock\n        if (isDockVisible \u0026\u0026 (currentScrollTop \u003e lastScrollTop)) {\n          hideDock();\n        }\n        break;\n    }\n\n    lastScrollTop = currentScrollTop;\n  }\n\n  // 显示 dock\n  function showDock() {\n    dock.classList.remove(\"translate-y-24\", \"opacity-0\", \"pointer-events-none\");\n    dock.classList.add(\"translate-y-0\", \"opacity-100\", \"pointer-events-auto\");\n    isDockVisible = true;\n  }\n\n  // 隐藏 dock\n  function hideDock() {\n    dock.classList.remove(\n      \"translate-y-0\",\n      \"opacity-100\",\n      \"pointer-events-auto\",\n    );\n    dock.classList.add(\"translate-y-24\", \"opacity-0\", \"pointer-events-none\");\n    isDockVisible = false;\n  }\n\n  // 切换悬浮模式 dock 显示状态\n  function toggleFloatDock() {\n    if (isDockVisible) {\n      hideDock();\n    } else {\n      showDock();\n    }\n  }\n\n  // 节流函数\n  function throttle(func, limit) {\n    let inThrottle;\n    return function () {\n      const args = arguments;\n      const context = this;\n      if (!inThrottle) {\n        func.apply(context, args);\n        inThrottle = true;\n        setTimeout(() =\u003e (inThrottle = false), limit);\n      }\n    };\n  }\n\n  // 绑定滚动事件（使用节流）\n  window.addEventListener(\"scroll\", throttle(handleScroll, 16)); // ~60fps\n\n  // 悬浮模式触发器事件处理\n  if (floatTrigger \u0026\u0026 dockMode === \"float\") {\n    let hoverTimer;\n    \n    // 点击触发器切换 dock\n    floatTrigger.addEventListener(\"click\", function (e) {\n      e.preventDefault();\n      toggleFloatDock();\n    });\n\n    // 悬浮显示 dock\n    floatTrigger.addEventListener(\"mouseenter\", function () {\n      clearTimeout(hoverTimer);\n      hoverTimer = setTimeout(() =\u003e {\n        if (!isDockVisible) {\n          showDock();\n        }\n      }, 150); // 150ms 延迟，避免误触发\n    });\n\n    floatTrigger.addEventListener(\"mouseleave\", function () {\n      clearTimeout(hoverTimer);\n      // 鼠标离开时隐藏 dock\n      setTimeout(() =\u003e {\n        if (isDockVisible \u0026\u0026 !dock.matches(':hover')) {\n          hideDock();\n        }\n      }, 200);\n    });\n\n    // dock 区域悬浮时保持显示\n    dock.addEventListener(\"mouseenter\", function () {\n      clearTimeout(hoverTimer);\n    });\n\n    dock.addEventListener(\"mouseleave\", function () {\n      setTimeout(() =\u003e {\n        if (isDockVisible \u0026\u0026 !floatTrigger.matches(':hover')) {\n          hideDock();\n        }\n      }, 200);\n    });\n\n    // 点击页面其他区域时隐藏 dock\n    document.addEventListener(\"click\", function (e) {\n      if (isDockVisible \u0026\u0026 !dock.contains(e.target) \u0026\u0026 !floatTrigger.contains(e.target)) {\n        hideDock();\n      }\n    });\n\n    // 阻止 dock 内部点击事件冒泡\n    dock.addEventListener(\"click\", function (e) {\n      e.stopPropagation();\n    });\n  }\n\n  // 基础按钮事件处理（占位符，后续实现具体功能）\n\n  // 返回按钮 - 只在非首页存在\n  const backBtn = document.getElementById(\"dock-back\");\n  if (backBtn) {\n    backBtn.addEventListener(\"click\", function (e) {\n      e.preventDefault();\n\n      // 实现智能返回功能\n      try {\n        // 检查是否有历史记录可以返回\n        if (window.history.length \u003e 1 \u0026\u0026 document.referrer) {\n          // 如果有引用页面且在同一域名下，使用浏览器返回\n          const referrerUrl = new URL(document.referrer);\n          const currentUrl = new URL(window.location.href);\n\n          if (referrerUrl.origin === currentUrl.origin) {\n            window.history.back();\n            console.log(\"返回按钮点击 - 浏览器返回\");\n            return;\n          }\n        }\n\n        // 否则跳转到首页\n        window.location.href = \"/\";\n        console.log(\"返回按钮点击 - 跳转首页\");\n      } catch (error) {\n        // 如果出现错误，默认跳转到首页\n        console.warn(\"返回功能出错，跳转到首页:\", error);\n        window.location.href = \"/\";\n      }\n    });\n  }\n\n  // 目录按钮 - 只在文章页面存在\n  const tocBtn = document.getElementById(\"dock-toc\");\n  if (tocBtn) {\n    tocBtn.addEventListener(\"click\", function (e) {\n      e.preventDefault();\n\n      // 调用目录功能，带重试机制\n      function tryToggleTOC(retries = 5) {\n        if (window.TOC \u0026\u0026 window.TOC.initialized) {\n          // 如果搜索modal是打开状态，先关闭搜索\n          if (window.Search \u0026\u0026 window.Search.isVisible \u0026\u0026 window.Search.isVisible()) {\n            window.Search.hide();\n          }\n          \n          // 切换目录状态\n          window.TOC.toggle();\n        } else if (window.TOC \u0026\u0026 !window.TOC.initialized \u0026\u0026 retries \u003e 0) {\n          setTimeout(() =\u003e tryToggleTOC(retries - 1), 200);\n        } else if (!window.TOC \u0026\u0026 retries \u003e 0) {\n          setTimeout(() =\u003e tryToggleTOC(retries - 1), 200);\n        }\n      }\n\n      tryToggleTOC();\n    });\n  }\n\n  // 搜索按钮\n  const searchBtn = document.getElementById(\"dock-search\");\n  if (searchBtn) {\n    searchBtn.addEventListener(\"click\", function (e) {\n      e.preventDefault();\n\n      // 调用搜索功能，带重试机制\n      function tryToggleSearch(retries = 5) {\n        if (window.Search) {\n          // 如果目录modal是打开状态，先关闭目录\n          if (window.TOC \u0026\u0026 window.TOC.initialized \u0026\u0026 window.TOC.isVisible \u0026\u0026 window.TOC.isVisible()) {\n            window.TOC.hide();\n          }\n          \n          // 切换搜索状态（如果已打开则关闭，否则打开）\n          if (window.Search.isVisible \u0026\u0026 window.Search.isVisible()) {\n            window.Search.hide();\n          } else {\n            window.Search.show();\n          }\n        } else if (retries \u003e 0) {\n          setTimeout(() =\u003e tryToggleSearch(retries - 1), 200);\n        }\n      }\n\n      tryToggleSearch();\n    });\n  }\n\n  // 评论按钮 - 只在文章页面且评论启用时存在\n  const commentsBtn = document.getElementById(\"dock-comments\");\n  if (commentsBtn) {\n    commentsBtn.addEventListener(\"click\", function (e) {\n      e.preventDefault();\n\n      // 实现滚动到评论区域功能\n      try {\n        // 尝试多种可能的评论区域选择器\n        const commentSelectors = [\n          \"#comments\", // 通用评论区域 ID\n          \".comments\", // 通用评论区域类\n          \"#giscus-container\", // Giscus 评论系统\n          \".giscus\", // Giscus 评论系统类\n          \"#disqus_thread\", // Disqus 评论系统\n          \".disqus\", // Disqus 评论系统类\n          \"#utterances\", // Utterances 评论系统\n          \".utterances\", // Utterances 评论系统类\n          \"#waline\", // Waline 评论系统\n          \".waline\", // Waline 评论系统类\n          \"[data-comments]\", // 带有 data-comments 属性的元素\n          \".comment-section\", // 评论区域类\n          \".post-comments\", // 文章评论类\n        ];\n\n        let commentElement = null;\n\n        // 按优先级查找评论元素\n        for (const selector of commentSelectors) {\n          commentElement = document.querySelector(selector);\n          if (commentElement) {\n            console.log(`找到评论区域: ${selector}`);\n            break;\n          }\n        }\n\n        if (commentElement) {\n          // 平滑滚动到评论区域\n          commentElement.scrollIntoView({\n            behavior: \"smooth\",\n            block: \"start\",\n            inline: \"nearest\",\n          });\n          console.log(\"评论按钮点击 - 滚动到评论区域\");\n        } else {\n          // 如果找不到评论区域，滚动到页面底部\n          window.scrollTo({\n            top: document.documentElement.scrollHeight,\n            behavior: \"smooth\",\n          });\n          console.log(\"评论按钮点击 - 未找到评论区域，滚动到页面底部\");\n        }\n      } catch (error) {\n        console.warn(\"滚动到评论区域失败:\", error);\n        // 出错时滚动到页面底部\n        window.scrollTo({\n          top: document.documentElement.scrollHeight,\n          behavior: \"smooth\",\n        });\n      }\n    });\n  }\n\n  // 返回顶部按钮\n  const topBtn = document.getElementById(\"dock-top\");\n  if (topBtn) {\n    topBtn.addEventListener(\"click\", function () {\n      // 平滑滚动到顶部\n      window.scrollTo({\n        top: 0,\n        behavior: \"smooth\",\n      });\n    });\n  }\n\n  // 初始化：根据模式设置 dock 状态\n  switch (dockMode) {\n    case \"always\":\n      showDock();\n      break;\n    case \"float\":\n      hideDock();\n      // 确保悬浮触发器可见\n      if (floatTrigger) {\n        floatTrigger.style.opacity = \"1\";\n      }\n      break;\n    case \"scroll\":\n    default:\n      hideDock();\n      break;\n  }\n\n  // 调试信息\n  if (\n    window.location.hostname === \"localhost\" ||\n    window.location.hostname === \"127.0.0.1\"\n  ) {\n    console.log(\n      \"Dock initialized successfully - positioned at perfect center bottom\",\n    );\n  }\n})();\n"],"mappings":"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","names":[]}